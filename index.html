<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="http://ok9ixm52w.bkt.clouddn.com/bitbug_favicon%20%281%29.ico?v=5.1.0" />






<meta name="description" content="???">
<meta property="og:type" content="website">
<meta property="og:title" content="wang_xun_xing">
<meta property="og:url" content="http://go.wangxx.win/index.html">
<meta property="og:site_name" content="wang_xun_xing">
<meta property="og:description" content="???">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="wang_xun_xing">
<meta name="twitter:description" content="???">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://go.wangxx.win/"/>





  <title> wang_xun_xing </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wang_xun_xing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just do iT!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/wstarxing" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github"></i> <br />
            
            menu.github
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/05/16/git-gitlab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/16/git-gitlab/" itemprop="url">
                  git- gitlab
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T15:14:53+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a><a href="https://about.gitlab.com/gitlab-com/" target="_blank" rel="external">gitlab</a></h1><p>开源代码管理</p>
<h2 id="setup"><a href="#setup" class="headerlink" title="setup"></a>setup</h2><p>方法1.<br><a href="https://about.gitlab.com/downloads/#ubuntu1604" target="_blank" rel="external">官方一键安装指导</a><br>一开始使用这种方式安装，结果出问题了，连不上数据库postgreal，半天没搞懂什么回事换了另一种方式<br>方法2.</p>
<ol>
<li><a href="https://bitnami.com/stack/gitlab" target="_blank" rel="external">bitnami-gitlab</a></li>
<li><a href="https://bitnami.com/stack/gitlab/README.txt" target="_blank" rel="external">doc</a> </li>
<li><p><a href="https://downloads.bitnami.com/files/stacks/gitlab/9.1.3-0/bitnami-gitlab-9.1.3-0-linux-x64-installer.run" target="_blank" rel="external">download</a></p>
<p> wget <a href="https://downloads.bitnami.com/files/stacks/gitlab/9.1.3-0/bitnami-gitlab-9.1.3-0-linux-x64-installer.run" target="_blank" rel="external">https://downloads.bitnami.com/files/stacks/gitlab/9.1.3-0/bitnami-gitlab-9.1.3-0-linux-x64-installer.run</a><br> chmod 777 ./bitnami-gitlab-9.1.3-0-linux-x64-installer.run<br> gitlab-ctl start # 启动<br> gitlab-ctl reconfigure # 初始化</p>
<h1 id="打开localhost可以看到gitlab网页"><a href="#打开localhost可以看到gitlab网页" class="headerlink" title="打开localhost可以看到gitlab网页"></a>打开localhost可以看到gitlab网页</h1><p> vi /etc/gitlab/gitlab.rb # 外网访问需修改</p>
<pre><code>external_url &apos;http://106.14.80.243&apos;
# nginx[&apos;redirect_http_to_https&apos;] 注释掉
</code></pre></li>
</ol>
<p>接着 gitlab-ctl reconfigure</p>
<h2 id="汉化"><a href="#汉化" class="headerlink" title="汉化"></a>汉化</h2><p>详情请看这位仁兄的</p>
<ol>
<li><a href="https://gitlab.com/xhang/gitlab" target="_blank" rel="external">gitlab</a><br>我采用其中的打补丁方式</li>
<li><a href="https://github.com/marbleqi/gitlab-ce-zh" target="_blank" rel="external">替换</a></li>
</ol>
<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>简单一键备份<br>1.<a href="https://segmentfault.com/a/1190000002439923" target="_blank" rel="external">方法</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/05/16/git-gitolite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/16/git-gitolite/" itemprop="url">
                  git-gitolite
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T15:14:40+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="git-gitolite"><a href="#git-gitolite" class="headerlink" title="git-gitolite"></a><a href="https://github.com/sitaramc/gitolite" target="_blank" rel="external">git-gitolite</a></h1><p>自建git的服务器，带有ssh-key控制的权限功能<br>优点：可以根据不同用户控制权限<br>缺点：需手动添加ssh-key</p>
<h2 id="steps-to-install"><a href="#steps-to-install" class="headerlink" title="steps to install"></a>steps to install</h2><ol>
<li>apt-get install git </li>
<li>useradd git</li>
<li>su git</li>
<li>cd</li>
<li>ssh-keygen -t rsa -C git</li>
<li>git clone <a href="http://github.com/sitaramc/gitolite" target="_blank" rel="external">http://github.com/sitaramc/gitolite</a></li>
<li>mkdir -p \$HOME/bin</li>
<li>gitolite/install -to \$HOME/bin</li>
<li>\$HOME/bin/gitolite setup -pk $HOME/.ssh/git.pub</li>
<li>git clone git@localhost:gitolite-admin</li>
</ol>
<h2 id="adding-users-and-repos"><a href="#adding-users-and-repos" class="headerlink" title="adding users and repos"></a>adding users and repos</h2><p>client in git bash:</p>
<ol>
<li>ssh-keygen -t rsa -C git UserName</li>
<li>scp C:\Users\yhn.ssh\id_rsa.pub git@IP:/home/git</li>
<li>in sourcetree: 工具-选项-SSH客户端配置-OpenSSH</li>
</ol>
<p>server:</p>
<ol>
<li>cd</li>
<li>mv /home/git/id_rsa.pub gitolite-admin/keydir/UserName.pub</li>
<li>cd gitolite-admin</li>
<li>vi /conf/gitolite.conf</li>
<li>git add .</li>
<li>git commig -m ‘add key add project add user’</li>
<li>git push</li>
</ol>
<h2 id="gitolite-conf"><a href="#gitolite-conf" class="headerlink" title="gitolite.conf"></a>gitolite.conf</h2><h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><pre><code>#group
@UserGroup      =   UserName UserName UserName

#project
repo ProjectName
    RW+                     =   UserName
    -   master              =   UserName
    -   refs/tags/v[0-9]    =   UserName
    RW                      =   UserName
    RW  refs/tags/v[0-9]    =   UserName
    R                       =   UserName
</code></pre><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>当新用户使用时，先把用户的ssh-key以用户名命名添加到keydir，然后在gitolite.conf添加对应用户，走git命令push到项目中。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/04/07/mongodb-aggregate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/07/mongodb-aggregate/" itemprop="url">
                  mongodb-aggregate
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-07T15:26:22+08:00">
                2017-04-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="mongodb-aggregate"><a href="#mongodb-aggregate" class="headerlink" title="mongodb-aggregate"></a>mongodb-aggregate</h1><p>聚合作用相当于做一些统计，在做统计前可以对其进行一定的处理，把结果一步一步</p>
<h2 id="聚合的简单统计"><a href="#聚合的简单统计" class="headerlink" title="聚合的简单统计"></a>聚合的简单统计</h2><h3 id="group"><a href="#group" class="headerlink" title="$group"></a>$group</h3><ul>
<li>\$sum，计算总和。</li>
<li>\$avg，计算平均值</li>
<li>\$min，获取集合中所有文档对应值得最小值。</li>
<li>\$max，获取集合中所有文档对应值得最大值。</li>
<li>\$push ，在结果文档中插入值到一个数组中。</li>
<li>\$addToSet ，在结果文档中插入值到一个数组中，但不创建副本</li>
<li>\$first，根据资源文档的排序获取第一个文档数据。</li>
<li>\$last， 根据资源文档的排序获取最后一个文档数据</li>
</ul>
<pre><code>   for i in item.aggregate([{&apos;$group&apos;: {&apos;_id&apos;: &apos;$reportID&apos;,
                             &apos;num1&apos;: {&apos;$sum&apos;: 1},
                             &apos;avg&apos;: {&apos;$avg&apos;: &apos;$itemVer&apos;},
                             &apos;max&apos;: {&apos;$max&apos;: &apos;$itemVer&apos;},
                             &apos;min&apos;: {&apos;$min&apos;: &apos;$itemVer&apos;},
                             &apos;first_url&apos;: {&apos;$first&apos;: &quot;$itemVer&quot;},
                             &apos;last_url&apos;: {&apos;$last&apos;: &quot;$itemVer&quot;},

                                    }}]):
       print i

\$push，\$addToSet 就是往group得出的结果中增加值
</code></pre><h2 id="使用管道处理"><a href="#使用管道处理" class="headerlink" title="使用管道处理"></a>使用管道处理</h2><h3 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h3><ul>
<li>\$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li>
<li>\$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li>
<li>\$limit：用来限制MongoDB聚合管道返回的文档数。</li>
<li>\$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li>
<li>\$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li>
<li>\$group：将集合中的文档分组，可用于统计结果。</li>
<li>\$sort：将输入文档排序后输出。</li>
<li>\$geoNear：输出接近某一地理位置的有序文档。</li>
</ul>
<pre><code>for i in test.aggregate([{&apos;$unwind&apos;: &apos;$imgSrc&apos;},
                         {&apos;$match&apos;:{&apos;imgSrc&apos;:&apos;abc&apos;}},
                         {&apos;$limit&apos;: 10},
                         {&apos;$skip&apos;: 5},
                         {&apos;$group&apos;: {&apos;_id&apos;: &apos;$reportID&apos;,&apos;num1&apos;: {&apos;$sum&apos;: 1}}},
                         ]):
    print i
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/04/05/flask-errorhandler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/05/flask-errorhandler/" itemprop="url">
                  flask-errorhandler
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-05T10:20:32+08:00">
                2017-04-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="flask-errorhandler"><a href="#flask-errorhandler" class="headerlink" title="flask-errorhandler"></a>flask-errorhandler</h1><h2 id="官方doc"><a href="#官方doc" class="headerlink" title="官方doc"></a><a href="http://flask.pocoo.org/docs/0.11/api/#flask.Flask.errorhandler" target="_blank" rel="external">官方doc</a></h2><p>error_handler_spec = None<br>A dictionary of all registered error handlers. The key is None for error handlers active on the application, otherwise the key is the name of the blueprint. Each key points to another dictionary where the key is the status code of the http exception. The special key None points to a list of tuples where the first item is the class for the instance check and the second the error handler function.</p>
<p>To register a error handler, use the errorhandler() decorator.</p>
<p>errorhandler(code_or_exception)<br>A decorator that is used to register a function give a given error code.<br>Example:</p>
<pre><code>@app.errorhandler(404)
def page_not_found(error):
    return &apos;This page does not exist&apos;, 404
</code></pre><p>You can also register handlers for arbitrary exceptions:</p>
<pre><code>@app.errorhandler(DatabaseError)
def special_exception_handler(error):
    return &apos;Database connection failed&apos;, 500
</code></pre><p>You can also register a function as error handler without using the errorhandler() decorator. The following example is equivalent to the one above:</p>
<pre><code>def page_not_found(error):
    return &apos;This page does not exist&apos;, 404
app.error_handler_spec[None][404] = page_not_found
</code></pre><p>Setting error handlers via assignments to error_handler_spec however is discouraged as it requires fiddling with nested dictionaries and the special case for arbitrary exception types.</p>
<p>The first None refers to the active blueprint. If the error handler should be application wide None shall be used.</p>
<p>New in version 0.7: Use register_error_handler() instead of modifying error_handler_spec directly, for application wide error handlers.</p>
<p>New in version 0.7: One can now additionally also register custom exception types that do not necessarily have to be a subclass of the HTTPException class.</p>
<p>Parameters: code – the code as integer for the handler</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="蓝图中直接使用"><a href="#蓝图中直接使用" class="headerlink" title="蓝图中直接使用"></a>蓝图中直接使用</h3><p>在request中出现了error导致中断，可以调用errorhandler去执行相关的函数，返回需要告知的信息，可以以预选定义错误代码，或定义的Exception触发<br>下面的列子是在蓝图中的错误才会触发</p>
<pre><code>@main.errorhandler(404)
def error_404(error):
    &quot;&quot;&quot;这个handler可以catch住所有abort(404)以及找不到对应router的处理请求&quot;&quot;&quot;
    response = dict(status=0, message=&quot;404 Not Found&quot;)
    return jsonify(response), 404

@main.errorhandler(Exception)
def error_500(error):
    &quot;&quot;&quot;这个handler可以catch住所有的abort(500)和raise exeception.&quot;&quot;&quot;
    response = dict(status=0, message=&quot;500 Error&quot;)
    return jsonify(response), 400

class MyError(Exception):
    &quot;&quot;&quot;自定义错误类&quot;&quot;&quot;
    pass

@main.errorhandler(MyError)
def MyErrorHandle(error):
    response = dict(status=0, message=&quot;400 Error&quot;)
    return jsonify(response), 400
</code></pre><h3 id="注册全局的错误处理"><a href="#注册全局的错误处理" class="headerlink" title="注册全局的错误处理"></a>注册全局的错误处理</h3><p>这是全局的错误</p>
<pre><code>@main.app_errorhandler(404)
def error_404(error):
    response = dict(status=0, message=&quot;404 Not Found&quot;)
    return jsonify(response), 404
</code></pre><h3 id="出现错误的request例子"><a href="#出现错误的request例子" class="headerlink" title="出现错误的request例子"></a>出现错误的request例子</h3><p>在admin_permission,如果没有admin的权限则出错，调用error_404去返回<br>在try中，data没有data值则raise 上面定义的MyError</p>
<pre><code>@main.route(&apos;/test&apos;, methods=[&apos;POST&apos;])
@login_required
@admin_permission.require(http_exception=404)
def pending_report(report_id, method):
    data = request.get_json(force=True)
    try:
        data = data[&apos;data&apos;]
    except Exception:
        raise MyError(&apos;data have no data&apos;)
    return jsonify()
</code></pre><h2 id="python–Exception"><a href="#python–Exception" class="headerlink" title="python–Exception"></a>python–Exception</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>只要继承了Exception就实现了异常类</p>
<pre><code>class DatabException(Exception):  
    def __init__(self,err=&apos;数据错误&apos;):  
        Exception.__init__(self,err)  
</code></pre><h3 id="raise错误"><a href="#raise错误" class="headerlink" title="raise错误"></a>raise错误</h3><p>在try…except中raise</p>
<pre><code>try:
    data = data[&apos;data&apos;]
except Exception, e:
    print e
    raise DatabException()
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/03/31/python-itertools/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/31/python-itertools/" itemprop="url">
                  python-itertools
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-31T15:30:16+08:00">
                2017-03-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python-itertools"><a href="#python-itertools" class="headerlink" title="python-itertools"></a>python-itertools</h1><p><a href="https://docs.python.org/2/library/itertools.html" target="_blank" rel="external">迭代器doc</a><br>Functional tools for creating and using iterators.</p>
<ol>
<li><p>Infinite iterators:</p>
<pre><code>count([n]) --&gt; n, n+1, n+2, ...
# 从n开始加，
# 可以设定值count(2,3) 2+3，5+3

cycle(p) --&gt; p0, p1, ... plast, p0, p1, ...
# 重复p中的值
# cycle(&apos;123&apos;), 1,2,3,1,2,3...

repeat(elem [,n]) --&gt; elem, elem, elem, ... endlessly or up to n times
# 重复elem n次
# repeat(1,10)
</code></pre></li>
<li><p>Iterators terminating on the shortest input sequence:</p>
<pre><code>chain(p, q, ...) --&gt; p0, p1, ... plast, q0, q1, ... 
# 连接两个循环
# chain([1,2,3],[4,5,6])

compress(data, selectors) --&gt; (d[0] if s[0]), (d[1] if s[1]), ...
# 根据selectors的值真假来选择中data的值
# compress([&apos;a&apos;,&apos;b&apos;,&apos;c&apos;,&apos;d&apos;],[1,0,0,1]) --&gt; &apos;a&apos;,&apos;d&apos;

dropwhile(pred, seq) --&gt; seq[n], seq[n+1], starting when pred fails
# 挑出false后面的所有值
# dropwhile(lambda x: x &lt; 5, [1, 3, 6, 7, 1]) --&gt;[6,7,1]

groupby(iterable[, keyfunc]) --&gt; sub-iterators grouped by value of keyfunc(v)
# 把iterable的值根据key来分组，对象需先sorted()排序
def a(b):
    if b &gt; 0:
        return &apos;a&apos;
    else:
        return &apos;b&apos;

c = [1,-1,0]
c = sorted(c, key=a)

for k,v in  groupby(c,key=a):
    print k,list(v)
--&gt; a [1],
--&gt; b [-1, 0]

ifilter(pred, seq) --&gt; elements of seq where pred(elem) is True

ifilterfalse(pred, seq) --&gt; elements of seq where pred(elem) is False

islice(seq, [start,] stop [, step]) --&gt; elements from
       seq[start:stop:step]

imap(fun, p, q, ...) --&gt; fun(p0, q0), fun(p1, q1), ...

starmap(fun, seq) --&gt; fun(*seq[0]), fun(*seq[1]), ...

tee(it, n=2) --&gt; (it1, it2 , ... itn) splits one iterator into n

takewhile(pred, seq) --&gt; seq[0], seq[1], until pred fails
# 当函数返回True时，收集元素到循环器。一旦函数返回False，则停止

izip(p, q, ...) --&gt; (p[0], q[0]), (p[1], q[1]), ... 
# 类似于zip()函数，只是返回的是一个循环器。

izip_longest(p, q, ...) --&gt; (p[0], q[0]), (p[1], q[1]), ... 
# 可以更多
</code></pre></li>
<li><p>Combinatoric generators:</p>
<pre><code>product(p, q, ... [repeat=1]) --&gt; cartesian product
permutations(p[, r])
# 排列组合，有顺序分别
combinations(p, r)
# 排列组合，无顺序分别
combinations_with_replacement(p, r)
# 可重复出现
</code></pre></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/03/28/flask-signal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/28/flask-signal/" itemprop="url">
                  flask-signal
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-28T15:38:15+08:00">
                2017-03-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="flask-signal"><a href="#flask-signal" class="headerlink" title="flask-signal"></a>flask-signal</h1><p><a href="http://docs.jinkan.org/docs/flask/signals.html" target="_blank" rel="external">信号机制-doc</a></p>
<h2 id="signal"><a href="#signal" class="headerlink" title="signal"></a>signal</h2><ol>
<li>“信号允许特定的发送端通知订阅者发生了什么”</li>
<li>当需要启动某函数去执行操作，就可以发送信号</li>
<li>稍微复杂的情况可参考上面的官方文档</li>
</ol>
<h2 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h2><h3 id="定义信号"><a href="#定义信号" class="headerlink" title="定义信号"></a>定义信号</h3><pre><code>from blinker import Namespace
test = Namespace() # 实际上,signal就是Namespace中的一个函数.
# Namespace继承dict.调用signal函数就是返回与key对应的value.初次调用signal时会触发KeyError.
test.signal = test.signal(&apos;name&apos;)
</code></pre><h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><pre><code>@test.connect_via(current_app)
def test_signal(current_app, args)
    print args

test.send(current_app, args=&apos;test&apos;)
</code></pre><h3 id="直接使用"><a href="#直接使用" class="headerlink" title="直接使用"></a>直接使用</h3><pre><code>test.connect(test_signal)
def test_signal(args)
    print args

test.send(&apos;test&apos;)
</code></pre><h3 id="两种方法区别"><a href="#两种方法区别" class="headerlink" title="两种方法区别"></a>两种方法区别</h3><p>装饰器可以带多个参数，但是要用名字传参<br>直接使用只有一个参数传入</p>
<h2 id="其他列子–来源网络"><a href="#其他列子–来源网络" class="headerlink" title="其他列子–来源网络"></a>其他列子–来源网络</h2><h3 id="source-1"><a href="#source-1" class="headerlink" title="source.1"></a><a href="http://www.jianshu.com/p/5c7bcf1af955" target="_blank" rel="external">source.1</a></h3><pre><code>from blinker import signal

def subscriber(sender):
    print(&quot;Got a signal sent by %r&quot; % sender)

ready = signal(&apos;ready&apos;)
ready.connect(subscriber)

class Processor:

    def __init__(self, name):
        self.name = name

    def go(self):
        ready = signal(&apos;ready&apos;)
        ready.send(self)
        print(&quot;Ready to Process...&quot;)
        complete = signal(&apos;complete&apos;)
        complete.send(self)

    def __repr__(self):
        return &apos;&lt;Processor %s&gt;&apos; % self.name

Processor_1 = Processor(&apos;intel core i3&apos;)
Processor_1.go()
</code></pre><p>定义了ready这个信号，绑定到subscriber这个函数，然后定义了一个class，在这个class去使用了send去调用</p>
<h2 id="flask内置的signals"><a href="#flask内置的signals" class="headerlink" title="flask内置的signals"></a>flask内置的signals</h2><pre><code>_signals = Namespace()

template_rendered = _signals.signal(&apos;template-rendered&apos;)
before_render_template = _signals.signal(&apos;before-render-template&apos;)
request_started = _signals.signal(&apos;request-started&apos;)
request_finished = _signals.signal(&apos;request-finished&apos;)
request_tearing_down = _signals.signal(&apos;request-tearing-down&apos;)
got_request_exception = _signals.signal(&apos;got-request-exception&apos;)
appcontext_tearing_down = _signals.signal(&apos;appcontext-tearing-down&apos;)
appcontext_pushed = _signals.signal(&apos;appcontext-pushed&apos;)
appcontext_popped = _signals.signal(&apos;appcontext-popped&apos;)
message_flashed = _signals.signal(&apos;message-flashed&apos;)
</code></pre><p>看英文就能看懂对应的信号是用来干嘛的，使用对应装饰器就能使用</p>
<h2 id="相关问题"><a href="#相关问题" class="headerlink" title="相关问题"></a>相关问题</h2><p>信号可以让你在一瞬间安全地订阅它们。例如，这些临时的订阅对测试很有帮助。使用信号时，不要让信号订阅者（接收者）发生异常，因为异常会造成程序中断。</p>
<h2 id="延伸问题"><a href="#延伸问题" class="headerlink" title="延伸问题"></a>延伸问题</h2><h3 id="current-app-get-current-object-与-current-app区别"><a href="#current-app-get-current-object-与-current-app区别" class="headerlink" title="current_app._get_current_object() 与 current_app区别"></a>current_app._get_current_object() 与 current_app区别</h3><p><a href="https://segmentfault.com/q/1010000005865632" target="_blank" rel="external">相关答案1</a><br><a href="http://stackoverflow.com/questions/9946136/flask-blue-print-current-app" target="_blank" rel="external">相关答案2</a><br><a href="http://www.programcreek.com/python/example/81023/flask.current_app._get_current_object" target="_blank" rel="external">example</a><br>与线程有关，当在某个线程中，使用current_app是获取不到的</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/03/24/python-data/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/24/python-data/" itemprop="url">
                  python--data
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-24T11:25:34+08:00">
                2017-03-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Python中的高级数据结构"><a href="#Python中的高级数据结构" class="headerlink" title="Python中的高级数据结构"></a>Python中的高级数据结构</h1><p><a href="http://blog.jobbole.com/65218/" target="_blank" rel="external">参考url</a></p>
<hr>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>python基本的数据结构有list,dict,set等，足够平常的使用，但在实现一些比较复杂的逻辑时，我们需要设计更好的数据结构去完成任务，此时我们需要去参考是否有更好的已经存在的数据结构，这样我们可以高效利用而不用浪费功夫去重复造轮子。<br>这些数据结构都是继承了最基本的数据结构，在这之上去构造一些新的属性和方法去丰富数据结构的功能。<br>下面就是一些python的高级数据结构例子可以供参考。</p>
</blockquote>
<hr>
<h2 id="collections"><a href="#collections" class="headerlink" title="collections"></a>collections</h2><blockquote>
<p>collections模块包含了内建类型之外的一些有用的工具，例如Counter、defaultdict、OrderedDict、deque以及nametuple。其中Counter、deque以及defaultdict是最常用的类。</p>
</blockquote>
<ol>
<li><p>Counter()</p>
<blockquote>
<p>‘’’Dict subclass for counting hashable items.  Sometimes called a bag<br> or multiset.  Elements are stored as dictionary keys and their counts<br> are stored as dictionary values.<br>是dict的子类，可以计算可哈希item的数量，Elements被保存成字典的key和他们数量的values</p>
</blockquote>
<pre><code> c = Counter(&apos;abcdeabcdabcaba&apos;)  
 # count elements from a string,计算字符串的出现的数值

 c.most_common(3)                
 # three most common elements,表示出现最多的3个
[(&apos;a&apos;, 5), (&apos;b&apos;, 4), (&apos;c&apos;, 3)]
sorted(c)                       
# list all unique elements，用list去保存其唯一的值
[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;, &apos;e&apos;]
&apos;&apos;.join(sorted(c.elements()))   
# list elements with repetitions,按出现次数及其位置重新生成字符串
&apos;aaaaabbbbcccdde&apos;
sum(c.values())                 
# total of all counts,计算其总数

c[&apos;a&apos;]                          
# count of letter &apos;a&apos;,获取其中的key出现的次数

for elem in &apos;shazam&apos;:           # update counts from an iterable
     c[elem] += 1      
# by adding 1 to each element&apos;s count，对其出现的key的values都加1
c[&apos;a&apos;]                          # now there are seven &apos;a&apos;

del c[&apos;b&apos;]                      # remove all &apos;b&apos;
c[&apos;b&apos;]                          # now there are zero &apos;b&apos;
</code></pre></li>
</ol>
<pre><code>d = Counter(&apos;simsalabim&apos;)       # make another counter
c.update(d)                     
# add in the second counter，把其他字符串的相加都一起，可以就单独计算后的合并
c[&apos;a&apos;]                          # now there are nine &apos;a&apos;
9

c.clear()                       # empty the counter，清空
Counter()

Note:  If a count is set to zero or reduced to zero, it will remain
in the counter until the entry is deleted or the counter is cleared:

c = Counter(&apos;aaabbc&apos;)
c[&apos;b&apos;] -= 2                     # reduce the count of &apos;b&apos; by two
c.most_common()                 # &apos;b&apos; is still in, but its count is zero
[(&apos;a&apos;, 3), (&apos;c&apos;, 1), (&apos;b&apos;, 0)]
</code></pre><ol>
<li>Deque<blockquote>
<p>Deque是一种由队列结构扩展而来的双端队列(double-ended queue)，队列元素能够在队列两端添加或删除。因此它还被称为头尾连接列表(head-tail linked list)，尽管叫这个名字的还有另一个特殊的数据结构实现。<br>Deque支持线程安全的，经过优化的append和pop操作，在队列两端的相关操作都能够达到近乎O(1)的时间复杂度。虽然list也支持类似的操作，但是它是对定长列表的操作表现很不错，而当遇到pop(0)和insert(0,v)这样既改变了列表的长度又改变其元素位置的操作时，其复杂度就变为O(n)了。</p>
</blockquote>
</li>
</ol>
<pre><code>def append(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Add an element to the right side of the deque. 
    在队列的右边增加新值
    &quot;&quot;&quot;

    pass

def appendleft(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Add an element to the left side of the deque. 
    在队列的左边增加新值
    &quot;&quot;&quot;
    pass

def clear(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Remove all elements from the deque. 
    清除队列所有的值
    &quot;&quot;&quot;
    pass

def count(self, value): # real signature unknown; restored from __doc__
    &quot;&quot;&quot; D.count(value) -&gt; integer -- return number of occurrences of value 
    统计value在deque出现的次数
    &quot;&quot;&quot;
    return 0

def extend(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Extend the right side of the deque with elements from the iterable 
    扩展可迭代的对象进入deque右边，如把list中的数据加入到deque中
    &quot;&quot;&quot;
    pass

def extendleft(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Extend the left side of the deque with elements from the iterable
     扩展可迭代的对象进入deque左边，插入到左边，按list中的顺序插，最后一个在最左边
    &quot;&quot;&quot;
    pass

def pop(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Remove and return the rightmost element. 
    删除deque中右边最后一个，并返回
    &quot;&quot;&quot;
    pass

def popleft(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Remove and return the leftmost element. 
    删除deque中左边边最后一个，并返回
    &quot;&quot;&quot;
    pass

def remove(self, value): # real signature unknown; restored from __doc__
    &quot;&quot;&quot; D.remove(value) -- remove first occurrence of value. 
    移除第一个出现的value
    &quot;&quot;&quot;
    pass

def reverse(self): # real signature unknown; restored from __doc__
    &quot;&quot;&quot; D.reverse() -- reverse *IN PLACE* 
    反向
    &quot;&quot;&quot;
    pass

def rotate(self, *args, **kwargs): # real signature unknown
    &quot;&quot;&quot; Rotate the deque n steps to the right (default n=1).  If n is negative, rotates left. 
    n = 1把第一个往后退一位，第一位用最后一位补充
    n = -1把第一个往前移一位变成最后一位，后面依次往前移
    像一个圆那样挪位
    &quot;&quot;&quot;
    pass
</code></pre><ol>
<li>Defaultdict<blockquote>
<p>这个类型除了在处理不存在的键的操作之外与普通的字典完全相同。当查找一个不存在的键操作发生时，它的default_factory会被调用，提供一个默认的值，并且将这对键值存储下来。其他的参数同普通的字典方法dict()一致，一个defaultdict的实例同内建dict一样拥有同样地操作。</p>
</blockquote>
</li>
</ol>
<p>defaultdict对象在当你希望使用它存放追踪数据的时候很有用</p>
<pre><code># 假定你希望追踪一个单词在字符串中的位置，那么你可以这么做:
from collections import defaultdict

s = &quot;the quick brown fox jumps over the lazy dog&quot;

words = s.split()
location = defaultdict(list)
for m, n in enumerate(words):
    location[n].append(m)

print location
# defaultdict(&lt;type &apos;list&apos;&gt;, {&apos;brown&apos;: [2], &apos;lazy&apos;: [7], &apos;over&apos;: [5], &apos;fox&apos;: [3], &apos;dog&apos;: [8], &apos;quick&apos;: [1], &apos;the&apos;: [0, 6], &apos;jumps&apos;: [4]})
# 是选择lists或sets与defaultdict搭配取决于你的目的，使用list能够保存你插入元素的顺序，而使用set则不关心元素插入顺序，它会帮助消除重复元素
from collections import defaultdict

s = &quot;the quick brown fox jumps over the lazy dog&quot;

words = s.split()
location = defaultdict(set)
for m, n in enumerate(words):
    location[n].add(m)

print location
# defaultdict(&lt;type &apos;set&apos;&gt;, {&apos;brown&apos;: set([2]), &apos;lazy&apos;: set([7]), &apos;over&apos;: set([5]), &apos;fox&apos;: set([3]), &apos;dog&apos;: set([8]), &apos;quick&apos;: set([1]), &apos;the&apos;: set([0, 6]), &apos;jumps&apos;: set([4])})

# 另一种创建multidict的方法：
s = &quot;the quick brown fox jumps over the lazy dog&quot;
d = {}
words = s.split()

for key, value in enumerate(words):
    d.setdefault(key, []).append(value)
print d
# {0: [&apos;the&apos;], 1: [&apos;quick&apos;], 2: [&apos;brown&apos;], 3: [&apos;fox&apos;], 4: [&apos;jumps&apos;], 5: [&apos;over&apos;], 6: [&apos;the&apos;], 7: [&apos;lazy&apos;], 8: [&apos;dog&apos;]}
</code></pre><ol>
<li><p>OrderedDict</p>
<blockquote>
<p>‘Dictionary that remembers insertion order’<br>字典是Python开发中很常用的一种数据结构，但dict有个缺陷（其实也不算缺陷），迭代时并不是按照元素添加的顺序进行，可能在某些场景下，不能满足我们的要求。<br>有序字典与字典是一样的功能，只不过它保持插入字典的顺序，当需要遍历时会先访问最先插入的项。<br>一个顺序字典会记住它的key第一次插入时的顺序<br>如果一新条目重写了一个已存在的条目，它第一次插入的顺序是不会改变的。<br>删除一个条目并重新插入它，那它的顺序将移动到末尾<br>所以从OrderedDict的字面意思就可以出来ordereddict是有顺序(key被插入的先后顺序)的字典，而普通的字典是无序的 。<br>判断两个有序字段是否相等(==)需要考虑元素插入的顺序是否相等</p>
</blockquote>
<pre><code>od = OrderedDict()
od[&apos;b&apos;] = &apos;bc&apos;
od[&apos;1&apos;] = 2
od[&apos;a&apos;] = &apos;a&apos;
od[&apos;A&apos;] = &apos;A&apos;
print od.keys()
# [&apos;b&apos;, &apos;1&apos;, &apos;a&apos;, &apos;A&apos;]

od1 = OrderedDict({&apos;b&apos;: &apos;bc&apos;, &apos;1&apos;: 2, &apos;a&apos;: &apos;a&apos;, &apos;A&apos;: &apos;A&apos;})
print od1.keys()
# [&apos;1&apos;, &apos;a&apos;, &apos;b&apos;, &apos;A&apos;]

od2 = OrderedDict([(&apos;b&apos;, &apos;bc&apos;), (&apos;1&apos;, 2), (&apos;a&apos;, &apos;a&apos;), (&apos;A&apos;, &apos;A&apos;)])
print od2.keys()
# [&apos;b&apos;, &apos;1&apos;, &apos;a&apos;, &apos;A&apos;]

od3 = {&apos;b&apos;: &apos;bc&apos;, &apos;1&apos;: 2, &apos;a&apos;: &apos;a&apos;, &apos;A&apos;: &apos;A&apos;}
print od3.keys()
# [&apos;1&apos;, &apos;a&apos;, &apos;b&apos;, &apos;A&apos;]

# 读取json串时保持原有顺序
import json  
from collections import OrderedDict  
metadata = json.loads(text, object_pairs_hook=OrderedDict);  

# 使用OrderedDict生成新按照key排序的dict
OrderedDict(sorted(d.items(), key=lambda t: t[0]))
OrderedDict([(&apos;apple&apos;, 4), (&apos;banana&apos;, 3), (&apos;orange&apos;, 2), (&apos;pear&apos;, 1)])
</code></pre></li>
<li><p>namedtuple</p>
<blockquote>
<p>namedtuple能够用来创建类似于tuple的数据类型，除了能够用索引来访问数据，能够迭代，更能够方便的通过属性名来访问数据。<br>在python中，传统的tuple类似于数组，只能通过下标来访问各个元素，我们还需要注释每个下标代表什么数据。通过使用namedtuple，每个元素有了自己的名字，类似于C语言中的struct，这样数据的意义就可以一目了然了。<br>nametuple用起来像一个class的实例，也像list，也像是dict，但需要事先声明像类一样，后面用法就相当于实例的使用，又好像是dict，还可以用下标的方式list那样去使用。<br>当然，声明namedtuple是非常简单方便的            </p>
</blockquote>
<pre><code>&quot;&quot;&quot;Returns a new subclass of tuple with named fields.
Point = namedtuple(&apos;Point&apos;, [&apos;x&apos;, &apos;y&apos;]) # 声明，创建一个类
Point.__doc__                   # docstring for the new class
&apos;Point(x, y)&apos;
p = Point(11, y=22)             # instantiate with positional args or keywords ,实例化
p[0] + p[1]                     # indexable like a plain tuple,用list下标方式使用
33
x, y = p                        # unpack like a regular tuple 赋值
x, y
(11, 22)
p.x + p.y                       # fields also accessible by name 像实例属性那样使用
33
d = p._asdict()                 # convert to a dictionary  像dict那样使用，注意要使用&quot;_asdict&quot;
d[&apos;x&apos;]
11
Point(**d)                      # convert from a dictionary  从dict导入
Point(x=11, y=22)
p._replace(x=100)               # _replace() is like str.replace() but targets named fields 重新赋值，注意要使用&quot;_replace&quot;方法
Point(x=100, y=22)
&quot;&quot;&quot;
</code></pre></li>
</ol>
<hr>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><blockquote>
<p>array模块定义了一个很像list的新对象类型，不同之处在于它限定了这个类型只能装一种类型的元素。array元素的类型是在创建并使用的时候确定的。<br>如果你的程序需要优化内存的使用，并且你确定你希望在list中存储的数据都是同样类型的，那么使用array模块很合适。<br>举个例子，如果需要存储一千万个整数，如果用list，那么你至少需要160MB的存储空间，然而如果使用array，你只需要40MB。但虽然说能够节省空间，array上几乎没有什么基本操作能够比在list上更快。<br>在使用array进行计算的时候，需要特别注意那些创建list的操作。例如，使用列表推导式(list comprehension)的时候，会将array整个转换为list，使得存储空间膨胀。一个可行的替代方案是使用生成器表达式创建新的array<br>总的来说，就是一个节省空间的list，里面的类型是一致的，在列表推导式中会变为list，所以最好的方法是用generato去创建新的array</p>
</blockquote>
<pre><code># array规定的类型
Type code   C Type             Minimum size in bytes 
&apos;c&apos;         character          1 
&apos;b&apos;         signed integer     1 
&apos;B&apos;         unsigned integer   1 
&apos;u&apos;         Unicode character  2 
&apos;h&apos;         signed integer     2 
&apos;H&apos;         unsigned integer   2 
&apos;i&apos;         signed integer     2 
&apos;I&apos;         unsigned integer   2 
&apos;l&apos;         signed integer     4 
&apos;L&apos;         unsigned integer   4 
&apos;f&apos;         floating point     4 
&apos;d&apos;         floating point     8 

import array

a = array.array(&quot;i&quot;, [1,2,3,4,5])
b = array.array(a.typecode, (2*x for x in a))

# 因为使用array是为了节省空间，所以更倾向于使用in-place操作。一种更高效的方法是使用enumerate
import array

a = array.array(&quot;i&quot;, [1,2,3,4,5])
for i, x in enumerate(a):
    a[i] = 2*x

# 对于较大的array，这种in-place修改能够比用生成器创建一个新的array至少提升15%的速度。

# 那么什么时候使用array呢？是当你在考虑计算的因素之外，还需要得到一个像C语言里一样统一元素类型的数组时。
import array
from timeit import Timer

def arraytest():
    a = array.array(&quot;i&quot;, [1, 2, 3, 4, 5])
    b = array.array(a.typecode, (2 * x for x in a))

def enumeratetest():
    a = array.array(&quot;i&quot;, [1, 2, 3, 4, 5])
    for i, x in enumerate(a):
        a[i] = 2 * x

if __name__==&apos;__main__&apos;:
    m = Timer(&quot;arraytest()&quot;, &quot;from __main__ import arraytest&quot;)
    n = Timer(&quot;enumeratetest()&quot;, &quot;from __main__ import enumeratetest&quot;)

    print m.timeit() # 5.22479210582
    print n.timeit() # 4.34367196717
</code></pre><h2 id="Heapq"><a href="#Heapq" class="headerlink" title="Heapq"></a>Heapq</h2><h3 id="堆的定义"><a href="#堆的定义" class="headerlink" title="堆的定义"></a>堆的定义</h3><p><a href="http://www.cnblogs.com/JVxie/p/4859889.html" target="_blank" rel="external">堆的基本概念及其操作</a></p>
<blockquote>
<p>堆是一种特殊的树形数据结构，每个节点都有一个值，通常我们所说的堆的数据结构指的是二叉树。<br>堆的特点是根节点的值最大（或者最小），而且根节点的两个孩子也能与孩子节点组成子树，亦然称之为堆。<br>堆分为两种，大根堆和小根堆是一颗每一个节点的键值都不小于（大于）其孩子节点的键值的树。<br>无论是大根堆还是小根堆（前提是二叉堆）都可以看成是一颗完全二叉树。下面以图的形式直观感受一下:<br><img src="http://ok9ixm52w.bkt.clouddn.com/1488882579345_10.png" alt=""><br>heapq模块使用一个用堆实现的优先级队列。堆是一种简单的有序列表，并且置入了堆的相关规则。<br>堆是一种树形的数据结构，树上的子节点与父节点之间存在顺序关系。二叉堆(binary heap)能够用一个经过组织的列表或数组结构来标识，在这种结构中，元素N的子节点的序号为2<em>N+1和2</em>N+2(下标始于0)。简单来说，这个模块中的所有函数都假设序列是有序的，所以序列中的第一个元素(seq[0])是最小的，序列的其他部分构成一个二叉树，并且seq[i]节点的子节点分别为seq[2<em>i+1]以及seq[2</em>i+2]。当对序列进行修改时，相关函数总是确保子节点大于等于父节点<br>操作时间在于O(1)-O(logn)<br>堆作为数据结构在内存和二级缓存中充当了重要的角色,优先队列</p>
</blockquote>
<pre><code>Usage:

heappush(heap, item) # pushes a new item on the heap， push item到堆中
item = heappop(heap) # pops the smallest item from the heap，pop最小的出堆
item = heap[0]       # smallest item on the heap without popping it，取堆中最小的值
heapify(x)           # transforms list into a heap, in-place, in linear time，线性化x为堆
item = heapreplace(heap, item) # pops and returns smallest item, and adds
                               # new item; the heap size is unchanged，把heap堆中最小的出堆返回，并插入item
nlargest(num, list)            #取list中最大的num个

nsmallest(num, list)           #取list中最小的num个


import heapq

heap = []  ##type的是list

for value in [20, 10, 30, 50, 40]:   
    heapq.heappush(heap, value)  # 处理入堆，这样形成的与heapify(x)一样

while heap:
    print heapq.heappop(heap)

# heapq模块有两个函数nlargest()和nsmallest()，顾名思义，让我们来看看它们的用法。

import heapq

nums = [1, 8, 2, 23, 7, -4, 18, 23, 42, 37, 2]
print(heapq.nlargest(3, nums)) # Prints [42, 37, 23]
print(heapq.nsmallest(3, nums)) # Prints [-4, 1, 2]

# 两个函数也能够通过一个键参数使用更为复杂的数据结构
import heapq

portfolio = [
{&apos;name&apos;: &apos;IBM&apos;, &apos;shares&apos;: 100, &apos;price&apos;: 91.1},
{&apos;name&apos;: &apos;AAPL&apos;, &apos;shares&apos;: 50, &apos;price&apos;: 543.22},
{&apos;name&apos;: &apos;FB&apos;, &apos;shares&apos;: 200, &apos;price&apos;: 21.09},
{&apos;name&apos;: &apos;HPQ&apos;, &apos;shares&apos;: 35, &apos;price&apos;: 31.75},
{&apos;name&apos;: &apos;YHOO&apos;, &apos;shares&apos;: 45, &apos;price&apos;: 16.35},
{&apos;name&apos;: &apos;ACME&apos;, &apos;shares&apos;: 75, &apos;price&apos;: 115.65}
]
cheap = heapq.nsmallest(3, portfolio, key=lambda s: s[&apos;price&apos;])
expensive = heapq.nlargest(3, portfolio, key=lambda s: s[&apos;price&apos;])

print cheap

# [{&apos;price&apos;: 16.35, &apos;name&apos;: &apos;YHOO&apos;, &apos;shares&apos;: 45},
# {&apos;price&apos;: 21.09, &apos;name&apos;: &apos;FB&apos;, &apos;shares&apos;: 200}, {&apos;price&apos;: 31.75, &apos;name&apos;: &apos;HPQ&apos;, &apos;shares&apos;: 35}]

print expensive

# [{&apos;price&apos;: 543.22, &apos;name&apos;: &apos;AAPL&apos;, &apos;shares&apos;: 50}, {&apos;price&apos;: 115.65, &apos;name&apos;: &apos;ACME&apos;, 
# &apos;shares&apos;: 75}, {&apos;price&apos;: 91.1, &apos;name&apos;: &apos;IBM&apos;, &apos;shares&apos;: 100}]

# 来看看如何实现一个根据给定优先级进行排序，并且每次pop操作都返回优先级最高的元素的队列例子。

import heapq

class Item:
    def __init__(self, name):
        self.name = name

    def __repr__(self):
        return &apos;Item({!r})&apos;.format(self.name)

class PriorityQueue:
    def __init__(self):
        self._queue = []
        self._index = 0

    def push(self, item, priority):
        heapq.heappush(self._queue, (-priority, self._index, item))
        self._index += 1

    def pop(self):
        return heapq.heappop(self._queue)[-1]

q = PriorityQueue()
q.push(Item(&apos;foo&apos;), 1)
q.push(Item(&apos;bar&apos;), 5)
q.push(Item(&apos;spam&apos;), 4)
q.push(Item(&apos;grok&apos;), 1)

print q.pop() # Item(&apos;bar&apos;)
print q.pop() # Item(&apos;spam&apos;)
print q.pop() # Item(&apos;foo&apos;)
print q.pop() # Item(&apos;grok&apos;)
</code></pre><h2 id="Bisect"><a href="#Bisect" class="headerlink" title="Bisect"></a>Bisect</h2><blockquote>
<p>bisect模块能够提供保持list元素序列的支持。<br>它使用了二分法完成大部分的工作。<br>它在向一个list插入元素的同时维持list是有序的。<br>在某些情况下，这比重复的对一个list进行排序更为高效，并且对于一个较大的list来说，对每步操作维持其有序也比对其排序要高效。</p>
</blockquote>
<pre><code>insort_right(a, x)   # 在a中插入x，a是sorted，如果存在x就插入x在右边
insort_left(a, x)    # 在a中插入x，a是sorted，如果存在x就插入x在左边
bisect_right(a, x)   # 在a中查找插入x的位置并返回，右边位置，不插入
bisect_left(a, x)    # 在a中查找插入x的位置并返回，左边位置，不插入
bisect(a, x)         # 在a中查插入x的位置，不插入

import bisect

a = [(0, 100), (150, 220), (500, 1000)]

bisect.insort_right(a, (250,400))

print a # [(0, 100), (150, 220), (250, 400), (500, 1000)]

# 我们可以使用bisect()函数来寻找插入点：
import bisect

a = [(0, 100), (150, 220), (500, 1000)]

bisect.insort_right(a, (250,400))
bisect.insort_right(a, (399, 450))
print a # [(0, 100), (150, 220), (250, 400), (500, 1000)]

print bisect.bisect(a, (550, 1200)) # 5

# bisect(sequence, item) =&gt; index 返回元素应该的插入点，但序列并不被修改。

import bisect

a = [(0, 100), (150, 220), (500, 1000)]

bisect.insort_right(a, (250,400))  
bisect.insort_right(a, (399, 450))
print a # [(0, 100), (150, 220), (250, 400), (500, 1000)]

print bisect.bisect(a, (550, 1200)) # 5
bisect.insort_right(a, (550, 1200))
print a # [(0, 100), (150, 220), (250, 400), (399, 450), (500, 1000), (550, 1200)]
</code></pre><h2 id="Weakref"><a href="#Weakref" class="headerlink" title="Weakref"></a>Weakref</h2><blockquote>
<p>weakref模块能够帮助我们创建Python引用，却不会阻止对象的销毁操作，<br>对象的非永久引用</p>
</blockquote>
<p>在开始之前，我们需要明白什么是strong reference。<br>strong reference是一个对对象的引用次数、生命周期以及销毁时机产生影响的指针。<br>strong reference如你所见，就是当你将一个对象赋值给一个变量的时候产生的：</p>
<pre><code> a = [1,2,3]
 b = a

# 在这种情况下，这个列表有两个strong reference，分别是a和b。在这两个引用都被释放之前，这个list不会被销毁

class Foo(object):
    def __init__(self):
        self.obj = None
        print &apos;created&apos;

    def __del__(self):
        print &apos;destroyed&apos;

    def show(self):
        print self.obj

    def store(self, obj):
        self.obj = obj

a = Foo() # created
b = a
del a
del b # destroyed

# Weak reference则是对对象的引用计数器不会产生影响。当一个对象存在weak reference时，并不会影响对象的撤销。这就说，如果一个对象仅剩下weak reference，那么它将会被销毁。

# 你可以使用weakref.ref函数来创建对象的weak reference。这个函数调用需要将一个strong
reference作为第一个参数传给函数，并且返回一个weak reference。

 import weakref
 a = Foo()
created
 b = weakref.ref(a)
 b

# 一个临时的strong reference可以从weak reference中创建，即是下例中的b()：
 a == b() 
True
 b().show()
None

# 请注意当我们删除strong reference的时候，对象将立即被销毁。

 del a
destroyed

# 如果试图在对象被摧毁之后通过weak reference使用对象，则会返回None：
 b() is None
True

# 若是使用weakref.proxy，就能提供相对于weakref.ref更透明的可选操作。同样是使用一个strong reference作为第一个参数并且返回一个weak reference，proxy更像是一个strong reference，但当对象不存在时会抛出异常。
 a = Foo()
created
 b = weakref.proxy(a)
 b.store(&apos;fish&apos;)
 b.show()
fish
 del a
destroyed
 b.show()
Traceback (most recent call last):
  File &quot;&quot;, line 1, in ?
ReferenceError: weakly-referenced object no longer exists


# 完整的例子：

# 引用计数器是由Python的垃圾回收器使用的，当一个对象的应用计数器变为0，则其将会被垃圾回收器回收。

# 最好将weak reference用于开销较大的对象，或避免循环引用(虽然垃圾回收器经常干这种事情)。
import weakref
import gc

class MyObject(object):
    def my_method(self):
        print &apos;my_method was called!&apos;

obj = MyObject()
r = weakref.ref(obj)

gc.collect()
assert r() is obj #r() allows you to access the object referenced: it&apos;s there.

obj = 1 #Let&apos;s change what obj references to
gc.collect()
assert r() is None #There is no object left: it was gc&apos;ed.

# 提示：只有library模块中定义的class instances、functions、methods、sets、frozen sets、files、generators、type objects和certain object types(例如sockets、arrays和regular expression patterns)支持weakref。内建函数以及大部分内建类型如lists、dictionaries、strings和numbers则不支持。
</code></pre><h2 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h2><blockquote>
<p>通过shallow或deep copy语法提供复制对象的函数操作。<br>shallow和deep copying的不同之处在于对于混合型对象的操作(混合对象是包含了其他类型对象的对象，例如list或其他类实例)。<br>对于shallow copy而言，它创建一个新的混合对象，并且将原对象中其他对象的引用插入新对象。<br>对于deep copy而言，它创建一个新的对象，并且递归地复制源对象中的其他对象并插入新的对象中。<br>普通的赋值操作知识简单的将心变量指向源对象。</p>
</blockquote>
<pre><code>import copy

a = [1,2,3]
b = [4,5]

c = [a,b]

# Normal Assignment
d = c

print id(c) == id(d)          # True - d is the same object as c
print id(c[0]) == id(d[0])    # True - d[0] is the same object as c[0]

# Shallow Copy
d = copy.copy(c)

print id(c) == id(d)          # False - d is now a new object
print id(c[0]) == id(d[0])    # True - d[0] is the same object as c[0]

# Deep Copy
d = copy.deepcopy(c)

print id(c) == id(d)          # False - d is now a new object
print id(c[0]) == id(d[0])    # False - d[0] is now a new object

# shallow copy (copy())操作创建一个新的容器，其包含的引用指向原对象中的对象。

# deep copy (deepcopy())创建的对象包含的引用指向复制出来的新对象。
</code></pre><p><img src="http://ok9ixm52w.bkt.clouddn.com/830203241171405010.jpg" alt=""></p>
<pre><code># 复杂的例子：

# 假定我有两个类，名为Manager和Graph，每个Graph包含了一个指向其manager的引用，而每个Manager有一个指向其管理的Graph的集合，现在我们有两个任务需要完成：

# 1) 复制一个graph实例，使用deepcopy，但其manager指向为原graph的manager。

# 2) 复制一个manager，完全创建新manager，但拷贝原有的所有graph。

import weakref, copy

class Graph(object):
    def __init__(self, manager=None):
        self.manager = None if manager is None else weakref.ref(manager)
    def __deepcopy__(self, memodict):
        manager = self.manager()
        return Graph(memodict.get(id(manager), manager))

class Manager(object):
    def __init__(self, graphs=[]):
        self.graphs = graphs
        for g in self.graphs:
            g.manager = weakref.ref(self)

a = Manager([Graph(), Graph()])
b = copy.deepcopy(a)

if [g.manager() is b for g in b.graphs]:
    print True # True

if copy.deepcopy(a.graphs[0]).manager() is a:
    print True # True
</code></pre><h2 id="Pprint"><a href="#Pprint" class="headerlink" title="Pprint"></a>Pprint</h2><blockquote>
<p>Pprint模块能够提供比较优雅的数据结构打印方式，如果你需要打印一个结构较为复杂，层次较深的字典或是JSON对象时，使用Pprint能够提供较好的打印结果。<br>假定你需要打印一个矩阵，当使用普通的print时，你只能打印出普通的列表，不过如果使用pprint，你就能打出漂亮的矩阵结构</p>
</blockquote>
<pre><code>import pprint

matrix = [ [1,2,3], [4,5,6], [7,8,9] ]
a = pprint.PrettyPrinter(width=20)
a.pprint(matrix)

# [[1, 2, 3],
#  [4, 5, 6],
#  [7, 8, 9]]
</code></pre><h2 id="基本的数据结构example"><a href="#基本的数据结构example" class="headerlink" title="基本的数据结构example"></a>基本的数据结构example</h2><ol>
<li><p>单链链表</p>
<pre><code>class Node:
def __init__(self):
    self.data = None
    self.nextNode = None

def set_and_return_Next(self):
    self.nextNode = Node()
    return self.nextNode

def getNext(self):
    return self.nextNode

def getData(self):
    return self.data

def setData(self, d):
    self.data = d

class LinkedList:
    def buildList(self, array):
        self.head = Node()
        self.head.setData(array[0])
        self.temp = self.head
        for i in array[1:]:
            self.temp = self.temp.set_and_return_Next()
            self.temp.setData(i)
            self.tail = self.temp
        return self.head
    def printList(self):
        tempNode = self.head
        while(tempNode!=self.tail):
            print(tempNode.getData())
            tempNode = tempNode.getNext()
        print(self.tail.getData())
myArray = [3, 5, 4, 6, 2, 6, 7, 8, 9, 10, 21]

myList = LinkedList()
myList.buildList(myArray)
myList.printList()
</code></pre></li>
<li><p>用Python实现的普林姆算法 </p>
<blockquote>
<p>普林姆算法(Prims Algorithm)是图论中，在加权连通图中搜索最小生成树的算法。</p>
</blockquote>
<pre><code>from collections import defaultdict
from heapq import heapify, heappop, heappush

def prim( nodes, edges ):
    conn = defaultdict( list )
    for n1,n2,c in edges:
        conn[ n1 ].append( (c, n1, n2) )
        conn[ n2 ].append( (c, n2, n1) )

    mst = []
    used = set( nodes[ 0 ] )
    usable_edges = conn[ nodes[0] ][:]
    heapify( usable_edges )

    while usable_edges:
        cost, n1, n2 = heappop( usable_edges )
        if n2 not in used:
            used.add( n2 )
            mst.append( ( n1, n2, cost ) )

            for e in conn[ n2 ]:
                if e[ 2 ] not in used:
                    heappush( usable_edges, e )
    return mst

#test
nodes = list(&quot;ABCDEFG&quot;)
edges = [ (&quot;A&quot;, &quot;B&quot;, 7), (&quot;A&quot;, &quot;D&quot;, 5),
          (&quot;B&quot;, &quot;C&quot;, 8), (&quot;B&quot;, &quot;D&quot;, 9), (&quot;B&quot;, &quot;E&quot;, 7),
      (&quot;C&quot;, &quot;E&quot;, 5),
      (&quot;D&quot;, &quot;E&quot;, 15), (&quot;D&quot;, &quot;F&quot;, 6),
      (&quot;E&quot;, &quot;F&quot;, 8), (&quot;E&quot;, &quot;G&quot;, 9),
      (&quot;F&quot;, &quot;G&quot;, 11)]

print &quot;prim:&quot;, prim( nodes, edges )
</code></pre></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/03/20/fastDFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/20/fastDFS/" itemprop="url">
                  fastDFS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-20T16:44:08+08:00">
                2017-03-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分布式存储-fastDFS"><a href="#分布式存储-fastDFS" class="headerlink" title="分布式存储-fastDFS"></a>分布式存储-fastDFS</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a><a href="http://tech.uc.cn/?p=221" target="_blank" rel="external">原理</a></h2><h2 id="架构剖析"><a href="#架构剖析" class="headerlink" title="架构剖析"></a><a href="http://os.51cto.com/art/201205/335144_all.htm" target="_blank" rel="external">架构剖析</a></h2><p>FastDFS是一个开源的轻量级分布式文件系统。它解决了大数据量存储和负载均衡等问题。特别适合以中小文件（建议范围：4KB &lt; file_size &lt;500MB）为载体的在线服务，如相册网站、视频网站等等。在UC基于FastDFS开发向用户提供了：网盘，社区，广告和应用下载等业务的存储服务。<br><img src="http://ok9ixm52w.bkt.clouddn.com/1489998243296_2.png" alt=""></p>
<h2 id="Ubuntu下部署FastDFS-5-05"><a href="#Ubuntu下部署FastDFS-5-05" class="headerlink" title="Ubuntu下部署FastDFS 5.05"></a>Ubuntu下部署FastDFS 5.05</h2><ol>
<li><p>安装所需要的库，工具</p>
<pre><code>apt-get install make gcc git libpcre3 libpcre3-dev zlib1g-dev
</code></pre></li>
</ol>
<ol>
<li><p>安装libfastcommon</p>
<pre><code>git clone https://github.com/happyfish100/libfastcommon.git
cd libfastcommon/
./make.sh
./make.sh install
# 设置环境变量或者创建软链接
export LD_LIBRARY_PATH=/usr/lib64/
ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
</code></pre></li>
<li><p>安装fastdfs</p>
<pre><code>wget https://nchc.dl.sourceforge.net/project/libfastcommon/libfastcommon_v1.01.tar.gz
tar xzf FastDFS.tar.gz
cd FastDFS/
./make.sh
./make.sh install
</code></pre></li>
<li><p>配置文件</p>
<pre><code># tracker服务器设置
cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf

vi /etc/fdfs/tracker.conf
# base_path=/home/x/log

# 客户端设置
cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf
vi /etc/client.conf
# tracker_server=&apos;tracker_ip&apos;:22122

# storage服务器设置
cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf
vi /etc/fdfs/storage.conf
# store_path0=/home/x/fastdfs0
# tracker_server=&apos;tracker_ip&apos;:22122
</code></pre></li>
<li><p>查看启动</p>
<pre><code># 启动
/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf
/usr/bin/fdfs_storaged /etc/fdfs/storage.conf
# 查看
ps -ef |grep fdfs
</code></pre></li>
</ol>
<ol>
<li><p>用python测试</p>
<pre><code>from fdfs_client.client import *
import time
# client.conf,上面设置的客户端conf
client_file = &apos;client.conf&apos;
# 本地待上传的文件
test_file = &apos;t.csv&apos;
# 下载文件名
download_file = &apos;test.txt&apos;

try:
    client = Fdfs_client(client_file)
    # upload
    ret_upload = client.upload_by_filename(test_file)
    print ret_upload
    time.sleep(5)  # 等待5s，否则下载时会报错文件不存在
    file_id = ret_upload[&apos;Remote file_id&apos;].replace(&apos;\\&apos;, &apos;/&apos;)  # 新版本文件存放Remote file_id格式变化
    print file_id
    # download
    ret_download = client.download_to_file(download_file, file_id)
    print ret_download

    # delete
    # file_id = &apos;group1/M00/00/00/wKgAq1jPipWAG1P4AAoRFLe1RaI439.csv&apos;
    ret_delete = client.delete_file(file_id)
    print ret_delete

except Exception, ex:
    print ex
</code></pre></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://go.wangxx.win/2017/03/16/abc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangxunxing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wang_xun_xing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/16/abc/" itemprop="url">
                  python-hello
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-16T16:49:14+08:00">
                2017-03-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python-hello"><a href="#python-hello" class="headerlink" title="python-hello"></a>python-hello</h1><p>hello!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  

          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ok9ixm52w.bkt.clouddn.com/17-1F2211F427.jpg"
               alt="wangxunxing" />
          <p class="site-author-name" itemprop="name">wangxunxing</p>
           
              <p class="site-description motion-element" itemprop="description">???</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangxunxing</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
